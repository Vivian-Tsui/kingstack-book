# 10. 监控服务 {#10}

金山私有云监控服务提供对云主机、物理机和交换机的性能监控查看和服务监控查看。

## 10.1 监控模板 {#10-1}

监控模版是指某种云资源的监控项目集合。比如云主机的监控模版可以是CPU使用率、内存使用率、网卡流量、磁盘I/O的监控项集合。租户可以指定一个监控模板，并将此模板与对应的云资源绑定。之后云平台便将会根据模板中包含的监控项对此资源进行监控，采集监控数据并展示在控制台上。

此外，金山私有云平台向用户提供自建监控模板的功能，创建模板时可以选择一个或多个监控项，并且可以为每个选定的监控项设置报警规则，当资源使用率达到报警上限时就会向用户发送报警信息。模板分为两种类型public和private。public类型的模板对所有tenant可见，private类型的模板仅属于特定的tenant，tenant之间不可见。详细的操作权限说明如下：


| 角色名称 | 创建/复制 | 删除 | 更新 | 查看 |
| :--- | | :--- | | :--- | | :--- | | :---| 
| Admin<br>/Serviceadmin<br>/Maintenanceadmin | Public、Private | Public、Private | Public、Private | Public、Private |
| 项目 Owner | Private | Private | Private | Public、Private |
| 项目 Member | -- | -- | -- | Public、Private |

其他注意事项如下：

1. 为被监控主机（物理机、交换机或虚拟机）创建监控时，提供可选模板列表，并且仅能选择一个模板。
2. 修改监控模板的监控项、trigger时，联动修改主机的监控信息；删除模板时不影响关联的主机。
3. 金山私有云平台自带的默认监控模板包含全量监控项，但是不包含报警规则。并且只能对它复制，不能进行修改、删除等其他操作。

### 10.1.1 创建监控模板 {#10-1-1}

1. 以admin或者maintenanceadmin账户登录控制台，建议采用后者。
2. 点击左侧导航条中的“监控 -> 监控模板“，在云主机监控模板页面下，点击“创建监控模板”，在弹出的输入框中输入模板名称、描述、并勾选“设为Public模板”（不勾选则模板为private类型），创建云主机监控模板。

   ![](/assets/创建监控模板-Admin.png)


### 10.1.2 管理监控项 {#10-1-2}

1. 在云主机监控模板页面，选中某个监控模板，点击右侧的  ![](/assets/icon-more.png)  按钮，选择“管理监控项”。
2. 在弹出的页面中选择监控项，然后点击“确定”。

   ![](/assets/管理监控项弹窗.png)
   
### 10.1.3 设置报警规则 {#10-1-3}

1. 在云主机监控模板页面，选中某个监控模板，点击右侧的 ![](/assets/icon-more.png) 按钮，选择“设定报警规则”。
2. 在弹出的页面中设置报警规则。对每个监控项都可以设置报警规则，用户可以根据情况自行设定。当资源使用率达到报警上限及持续时间时就会向用户发送报警信息。
   
   ![](/assets/设置报警规则.png)
   
### 10.1.4 更多操作 {#10-1-4}

除管理监控项、设置报警规则外，每个监控模板的右侧还提供了更多其他操作的入口，包括编辑模板、删除模板、复制模板。

| 操作 | 对应按钮 | 前提条件 | 描述 |
| :--- | | :--- | | :--- | | :--- |
| 编辑模板 | ![](/assets/icon-edit.png) | -- | 修改监控模板的名称、描述信息、public/private类型 |
| 删除模板 | ![](/assets/icon-delete.png) | 监控模板上已经没有绑定的云资源 | 模板下有绑定的云资源时不允许删除 |
| 复制模板 | ![](/assets/icon-more.png) | 复制模板命名时不可与已有监控模板重名 | 复制模板时将复制已有模板的监控项和报警规则 |

## 10.2 告警接收管理 {#10-2}

金山私有云平台支持创建告警接收组，并向接收组里添加告警接收人，当资源使用率超过设定值，触发报警信息后，会向所绑告警接收组里的所有报警接收人发送报警信息。不同角色对告警接收组的操作不同：

| 角色名称 | 创建 | 删除 | 更新 | 查看 |
| :--- | | :--- | | :--- | | :--- | | :---| 
| Admin<br>/Serviceadmin<br>/Maintenanceadmin | Public、Private | Public、Private | Public、Private | Public、Private |
| 项目 Owner | Private | Private | Private | Public、Private |
| 项目 Member | -- | -- | -- | Public、Private |

### 10.2.1 创建接收组 {#10-2-1}

1. 以admin或者maintenanceadmin账户登录控制台，建议采用后者。
2. 点击左侧导航条中的“监控 -> 告警接收管理“，在右侧页面点击“创建接收组”，在弹出的输入框中输入接收组名称、描述、并勾选接收信息的方式，接收方式可选“邮件”或“短信”（必须选择一种接收方式）。
3. 如将接收组设为public， 则接收组对所有tenant可见， private类型的接收组则仅属于特定的tenant，tenant之间不可见。

   ![](/assets/创建接收组弹窗.png)
   
### 10.2.2 添加接收人 {#10-2-2}

在告警接收管理页面选中某一特定接收组，可向组内添加接收人。

点击“添加接收人”按钮，在弹出的输入框中输入接收人姓名、邮箱、手机（若创建接收组的时候接收方式没选“短信”则不用填写手机号码，同理，若接收方式没有选择“邮件”则无需填写邮箱）。

![](/assets/添加接收人弹窗.png)

添加接收人时，即可增加新用户，也可选择现有系统用户：填写接收人姓名时，将与已有的系统用户进行模糊匹配，列出与所输入姓名相匹配的系统用户，在下拉列表中选择某系统用户后，该用户的邮箱和手机信息将自动填充。

![](/assets/添加接收人-下拉匹配.png)

### 10.2.3 更多操作 {#10-2-3}

| 操作 | 对应按钮 | 前提条件 | 描述 |
| :--- | | :--- | | :--- | | :--- |
| 编辑接收人 | ![](/assets/icon-edit.png) | -- | 修改接收人的名称、邮箱和手机 |
| 删除接收人 | ![](/assets/icon-delete.png) | 接收人所在的告警接收组已经没有绑定的云资源 | 接收组下有绑定的云资源时不允许删除 |

## 10.3 控制节点监控（仅管理员） {#10-3}

管理员可登录控制台查看所有控制节点的性能监控信息和服务监控信息。

1、以admin或者maintenanceadmin账户登录控制台，建议采用后者。2、点击左侧导航栏下的“监控->控制节点”，即可查看当前控制节点的性能监控信息和服务监控信息。点击右上角“controller”可切换不同的控制节点。

### 10.3.1 性能监控

“性能监控”展示对当前控制节点的以下性能进行监控：资源使用率（内存使用率和CPU使用率）、磁盘IO（读写速率、IO平均时间等）、磁盘挂载点和网卡（网络流量）。点击监控曲线上某一点，方框中显示该点所在位置的精确时间和监控项的具体值。除实时监控以外，点击右侧的“1天”、“7天”可分别查看最近一天和最近一周的监控数据。

### 10.3.2 服务监控

“服务监控”展示当前控制节点所有服务的信息，包括服务名称、服务属性、服务状态、子服务个数和操作。点击“操作”下的“查看详情”可查看对应服务的详细信息。








