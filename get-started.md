# 2. 快速指南 {#2} 

本部分内容旨在帮助用户通过控制台快速上手使用金山私有云平台创建云主机，卷等虚拟资源，因此只会涉及最基本的操作，如需了解功能的具体细节请参考后面的各项功能详细介绍。

## 2.1 部署节点 {#2-1}

首先，管理员可通过“节点部署管理”进行KingStack云环境的部署安装。KingStack的节点可分为一下类型：

| 节点类型 | 功能说明 | 安装部署方式 |
| :--- | |:--- | | :--- |
| 控制节点 | 云平台的全部管理组件都部署在控制节点 | 通过自动化脚本安装 |
| 计算节点 | 计算节点用于部署计算虚拟化的相关组件 | 依靠图形化界面安装部署 |
| 存储节点 | 存储节点用于部署分布式存储的相关组件 | 依靠图形化界面安装部署 |
| 网络节点 | 网络节点用于部署Neutron等网络的相关组件 | 依靠图形化界面安装部署 |

部署节点的具体步骤如下：

1. 以admin或者maintenanceadmin账户登录控制台，建议采用后者。
2. 点击左侧菜单栏的“管理->节点部署管理”，进入节点部署页面，该页面包含了两部分：部署服务器和节点列表。
3. 将部署服务器由“Down”状态设置为“Active”状态。
4. 添加裸机节点。点击列表右上角的“添加节点”按钮，在弹出框中填写节点名称、IPMI接口信息以及管理IP等信息。完毕后，点击“确认”提交。
5. 安装系统。点击具体节点右侧的“安装OS”功能链接，为物理节点安装系统。
6. 配置网络。点击具体节点右侧的“配置网络”功能链接，可在弹出框中执行发现网卡、编辑网卡信息和配置bond的操作。当已为节点指定角色并完成部署后，“配置网络”功能将禁用不可点击。
7. 指定节点角色。在节点列表中选定指定的节点，点击“部署节点”。在弹出框中勾选节点类型，同时填写节点的网卡信息以及存储网络信息。

## 2.2 创建网络分区 {#2-2}

网络分区是指将云的网络按一定区域进行划分和管理。不同的区域与不同的网络节点绑定。在租户指定虚拟网络要创建在哪个区域上后，对应网络资源实例则会下发到与此区域绑定的网络节点上。

1. 点击左侧“管理”打开菜单，选择“网络分区管理”。

2. 点击屏幕右上角的“创建分区”，在弹出对话框中填写名称以及描述信息，点击“确定”提交配置。

3. 在建立好的分区列表上选择“管理网络节点”，在弹出对话框中添加网络节点，将分区与指定的网络节点进行绑定。

## 2.3 添加计算及存储资源池 {#2-3}

金山私有云平台以项目的方式对资源、人员进行管理，每一个用户都会分配到某一个项目。每个项目又需要绑定到于一个或多个资源上。因此，我们首先创建一个资源池test。

1. 以admin或者maintenanceadmin账户登录控制台，建议采用后者。

2. 点击左侧菜单栏的“管理”菜单，进入下拉菜单。进入“计算节点管理”页面，点击页面右上方“创建资源池”按钮，在弹窗中填写资源池的名字、静态调度策略、CPU复用比以及RAM复用比，添加一个或多个网络分区，点击“确定”完成创建。成功后可在资源池列表中查看到。

 ![](/assets/创建资源池test.png)
 
CPU复用比：是指物理核与虚拟核的资源复用比例。数值越大代表单核物理CPU可虚拟出的虚拟CPU越多。
RAM复用比：是指物理内存与虚拟内存的资源复用比例。数值越大代表单位物理内存可虚拟出的虚拟内存越多。
 
3. 在计算节点列表部分，点击计算节点右侧对应的“上线”按钮，选择要上线的资源池，点击“确定”上线计算节点。

## 2.4 管理员创建项目和用户账户 {#2-4}

为了方便理解，假设我们创建一个名字为test的项目，绑定到上一步创建的资源池test，并为此项目分配租户管理员test_admin。

1. 以admin或者serviceadmin账户登录控制台，建议采用后者。

2. 点击左侧菜单栏的“管理”菜单，进入下拉菜单。

3. 选择“项目管理”，点击“创建项目”。添加项目名称并绑定对应的资源池，点击“创建”提交配置。

 ![](/assets/创建项目test.png)

4. 点击“用户管理”，进入用户管理页面。
5. 点击“创建用户”，添加用户名、密码、手机号码、邮箱及所属的项目信息。点击“创建”提交配置。

 ![](/assets/创建用户.png)

至此，完成了项目和对应的租户管理员账户的创建。
 
## 2.5 租户管理员创建云主机及网络等 {#2-5}

为了方便理解，假设我们现在创建一台云主机，这台云主机需要一个50G的数据盘并且可以连接外网。

### 2.5.1 创建路由 {#2-5-1}

1. 以项目owner角色登录WEB控制台（本例中为上文建立的test_admin账户）。
2. 点击左侧导航条中的“网络 -> 路由管理“，进入虚拟路由器列表页。
3. 点击右上角“创建路由”按钮，在弹出的输入框中输入路由器名称、选择外部网络并设置带宽后，选择”创建路由“按钮即完成路由创建。

 ![](/assets/创建路由.png)

### 2.5.2 创建网络及子网 {#2-5-2}

1. 点击左侧导航条中的“网络 -> 网络管理“，进入虚拟网络列表页面。
2. 点击右上角“创建网络”按钮，在弹出框中输入要创建的网络名称，选择网络区域，填写子网名称、网络地址、网关IP，并且选择在第一步中创建好的路由器，然后点击“确定”按钮即完成虚拟网络及子网的创建。

 ![](/assets/创建网络弹窗.png)

创建子网的原因：只有虚拟网络还无法创建云主机，还需要在创建好的网络中至少创建一个子网用来挂载路由器和云主机。

### 2.5.3 创建云主机

1. 点击左侧导航条中的“云主机”，接着在右侧的右上角点击“创建云主机”按钮，这时就会弹出创建云主机的向导。
2. 第一步：基本配置
输入云主机名称、云主机数量（最多可同时创建20台同规格的云主机）、分配资源池、选择登录方式（如选择证书登录则需选择证书）、选择主机组（也可暂不添加至主机组）、选择是否增加GPU，然后点击下一步。

 ![](/assets/创建云主机表单-1.png)

3. 第二步：选择GPU（如在第一步中勾选了“增加GPU”，则需选择GPU，如未勾选则直接跳至第三步）
选择GPU型号，设置GPU数量，选择物理机（可自动分配，也可手动选择），然后点击下一步。

 ![](/assets/创建云主机表单-2.png)

4. 第三步：选择镜像
选择镜像类型，然后选择镜像并点击下一步。

 ![](/assets/创建云主机表单-3.png)

5. 第四步：主机配置
CPU、内存可以按照云主机上应用的需求灵活定制。金山私有云平台默认系统磁盘50G，如需要更大的空间可以以增加数据盘的方式挂载到云主机上。平台默认创建一个“default”安全组。

 ![](/assets/创建云主机表单-4.png)

6. 第五步：网络设置
在“网络设置”向导中选择云主机使用的虚拟网络、子网并为子网网卡分配IP。

 ![](/assets/创建云主机表单-5.png)

7. 点击“创建”按钮，完成创建云主机流程。所创建实例将在云主机列表中显示，用户可对云主机进行更多操作。

正常情况下云主机会在10秒以内创建完成，并且会自动分配一个内网地址给新建的云主机。用户可以通过VNC进行登录。

### 2.5.2 创建数据卷并挂载云主机

1. 点击左侧导航条中的“存储->卷管理”，进入卷列表页面。
2. 点击右上角的“创建卷”按钮，在弹出的对话框中输入新建卷的名称、数量、描述，数据来源选择“无源，卷是空的”，选择磁盘类型和卷类型，卷的大小设置为50G，暂不开启多主机挂载，最后点击“确定”即可。 
3. 在创建好的test-volume卷右侧，点击“挂载主机”按钮，在弹出的对话框中选择前面步骤创建的云主机，最后点击“确定”即完成数据卷的挂载。


用户可以通过VNC登录到云主机，用fdisk –l之类的工具就可以看到新创建的硬盘，金山私有云平台第一块数据盘会默认挂载到/dev/vdb目录。


### 2.5.3 给云主机分配浮动IP

1. 点击左侧导航栏中的“网络 -> 浮动IP管理”，进入浮动IP列表页面。
2. 在浮动IP列表页面中点击右上角”创建浮动IP”，在弹出的对话框中选择默认的外部网络，点击”确定“即完成浮动IP的创建。
3. 选中新创建的浮动IP，点击右侧“更多操作->关联端口”，在弹出的对话框中选择新创建的云主机，设置带宽，然后点击“关联”按钮，即完成浮动IP到云主机的关联。

至此一个简单的操作流程就完成了，用户可以通过SSH的方式从外部访问到此台云主机。





