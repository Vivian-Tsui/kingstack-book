# 7. 网络服务 {#7}

如果用户的云主机有访问外网的需求，可以通过三种方式实现：

1. 云主机关联浮动IP，关联浮动IP的云主机可从外部被访问到。
2. 云主机所在子网关联路由器，因为路由器在创建时分配的IP就是浮动IP。
3. 通过端口转发功能，创建虚机端口与路由端口的端口转发规则。

权限说明

待补充

## 7.1 外部网络管理 {#7-1}

待补充

## 7.2 网络管理 {#7-2}

### 7.2.1 功能说明 {#7-2-1}

用户可创建多个网络，在每个网络内，可创建多个子网，处于同一个子网内的主机可以相互通信，子网之间是完全隔离的。如果两个子网之间需要通信，需要将两个子网关联到同一个路由器。

### 7.2.2 网络列表 {#7-2-2}

点击左侧导航栏“网络->网络管理”，进入网络管理页面，即可查看当前网络列表，列表所含字段具体如下：

* 名称：网络的名字，由用户创建网络时填写。
* 状态：该字段显示当前网络是否正常可用。
* 网络类型：vlan、flat等。
* 物理网络：网络所关联的物理网络。
* 分段标识：一个整数数字，在创建网络完成时由系统随机分配。
* 项目：网络所属的租户名称。

在网络列表中，用户可通过输入网络名称、分段标识和物理机网络的名称进行精确查询，也可按照网络分区和项目名称进行筛选。

### 7.2.3 网络相关操作 {#7-2-3}

针对网络的操作包括：创建网络、编辑网络、删除网络。

| 操作 | 前提条件 | 描述 |
| :--- | | :--- | | :--- |
| 创建网络 | 当前项目下已经创建至少一个路由 | 点击右上角“创建网络”按钮，在弹窗中输入网络名称，选择网络区域，填写子网名称、网络地址、网关IP，然后选择一个匹配的路由，最后点击“确定”按钮。 |
| 编辑网络 | -- | 选中一个网络，点击右上角“更多操作->编辑网络”，可在弹出框中更改网络名称。 |
| 删除网络 | 网络下没有子网 | 选中一个网络，若它包含的子网数为零，点击右上角“更多操作->删除网络”。 |

创建网络弹窗：

![](/assets/创建网络弹窗.png)

### 7.2.4 子网列表 {#7-2-4}

点击具体网络的名称，将打开该网络下的子网列表。其中，各字段含义如下：

* 名称：子网的名字，在创建子网时由用户填写。
* 网络地址：显示子网所在网段。
* IP版本：IPV4。
* 网关IP：网关IP为创建子网时指定。
* 关联路由：子网所关联的路由。

### 7.2.5 子网相关操作 {#7-2-5}

针对子网的操作包括：创建子网、编辑子网、删除子网。

| 操作 | 前提条件 | 描述 |
| :--- | | :--- | | :--- |
| 创建子网 | 当前项目下已经创建至少一个路由 | 点击右上角“创建网络”按钮，在弹窗中输入子网名称、网络地址、网关IP，然后选择一个匹配的路由，最后点击“确定”按钮。 |
| 编辑子网 | -- | 选中一个子网，点击右上角“更多操作->编辑子网”，可在弹出框中更改子网名称。 |
| 删除子网 | a. 该子网没有关联任何路由</br>b. 该子网的IP没有分配到任何云主机上| 选中一个子网，若它没有关联任何资源，点击右上角“更多操作->删除子网”，在弹出框中点击“删除”即可。 |

## 7.3 路由管理 {#7-3}

### 7.3.1 功能说明 {#7-3-1}

路由主要有两个作用：

1. 作为外网与用户私有网络之间的通道：比如开启外网关并绑定外网IP之后，便可以通过VPN或端口转发功能从外部访问云内部网络资源。
2. 作为用户多个子网之间路由功能。

### 7.3.2 路由列表 {#7-3-2}

登录控制台，点击左侧导航栏“网络->路由管理”，即可查看路由列表。其中，各个字段的含义如下：

* 名称：路由器的名字，由用户创建时填写。
* 状态：表示该路由当前是否正常可用。
* 带宽：表示当前路由的带宽，单位为Mbps。
* 外部网关：创建路由时选择的外部网络，默认为external。
* 外部IP：创建路由时自动分配。
* 类型：ha/活动/占用，表示不同的路由类型。
* 标识：uuid，路由唯一标识符。
* 项目：路由所属的项目。

### 7.3.3 路由相关操作 {#7-3-3}

针对路由的操作包括：创建路由、编辑路由、修改带宽、删除路由。

| 操作 | 前提条件 | 描述 |
| :--- | | :--- | | :--- |
| 创建路由 | -- | 点击右上角“创建路由”按钮，在弹出的输入框中输入路由器名称，选择网络分区和外部网络（默认为external），设置带宽，最后点击“创建”按钮即可创建路由器。 |
| 编辑路由 | -- | 点击路由右侧的编辑图标，可在弹出框中更改路由名称。 |
| 修改带宽 | -- | 点击路由右侧的“修改带宽”功能链接，可在弹出框中更改路由带宽。 |
| 删除路由 | 该路由上已经没有关联的子网、端口转发、vpn等 | 若某个路由没有关联任何资源，点击右侧的删除图标，在弹出框中点击“删除”即可。 |

在路由列表中，用户可通过输入路由名称、外部IP进行精确查询，也可按照网络分区和项目名称进行筛选。

![](/assets/创建路由.png)

### 7.3.4 路由接口列表 {#7-3-4}

点击某个路由的名称，即可进入到该路由的接口列表。其中，各个字段的含义如下：

* 固定IP：关联子网的网关IP。
* 关联子网：关联到该路由上的子网。
* 状态：指示该接口当前是否正常可用。

### 7.3.5 接口相关操作 {#7-3-5}

在接口列表可进行的操作有：添加接口、删除接口。

| 操作 | 前提条件 | 描述 |
| :--- | | :--- | | :--- |
| 添加接口 | -- | 点击右上角“添加接口”按钮，在弹窗中选择子网，点击“添加按钮”按钮即可。 |
| 删除接口 | 该接口未关联任何资源 | 选中一个接口，若它没有关联任何资源，点击右上角“更多操作->删除接口”，在弹出框中点击“删除”即可。 |

## 7.4 端口转发管理 {#7-4}

### 7.4.1 功能说明 {#7-4-1}

金山私有云向用户提供端口转发功能，实现了用一个public IP，通过不同的端口以及TCP/UDP协议映射来访问不同机器。端口转发创建成功后，能将针对路由器公网IP地址的某个端口的请求转发到子网的某个云主机IP地址上，而不需要给每个云主机均绑定公网IP来访问，避免将子网主机完全暴露在公网中，并能缓解公网IP资源匮乏的问题。

### 7.4.2 端口转发规则列表 {#7-4-2} 

登录控制台，点击左侧导航栏“网络->端口转发管理”，即可查看端口转发规则列表。其中各字段含义如下：

* 规则名称：端口转发规则的名称，由用户创建时填写。
* 虚机IP地址：与转发规则相关联虚机的IP地址。
* 虚机端口：由用户手动填写，端口范围为：0-65535。
* 路由器网关IP：与转发规则相关联的路由器网关IP。
* 路由器端口：创建转发规则时，系统将会为端口转发字段分配路由端口。
* 协议：TCP/IP
* 创建时间：端口转发规则创建成果的时间。
* 项目：端口转发规则所属项目。
* 描述：对端口转发规则的描述。

在端口转发列表中，用户可通过输入端口转发规则名称、虚机IP进行精确查询，也可按照项目名称进行筛选。

### 7.4.3 相关操作 {#7-4-3}

| 操作 | 描述 |
| :--- | | :--- |
| 创建转发规则 | 点击右上角“创建转发规则”按钮，在弹窗中输入规则名称、规则描述（可选），选择虚机所属网络、选择虚机IP地址(选择虚机IP地址后，会自动匹配出路由器网关IP)，填写虚机端口并选择协议，最后点击“确定”创建转发规则。 |
| 删除转发规则 | 点击转发规则右侧的删除图标，在弹窗中点击“删除”即可。 |

![](/assets/关联路由器网关IP.png)

### 7.4.4 注意事项 {#7-4-4}

1. 删除虚机，删除对应规则。
2. 删除路由器，删除对应规则。
3. 对于一个特定虚机的特定端口，可以配置多条规则。
4. 对于一个特定路由器的特定端口，每种协议只能配置一次。

## 7.5 浮动IP管理 {#7-5}

### 7.5.1 功能说明 {#7-5-1}

浮动IP为云主机和路由器提供全球可直接访问的互联网地址，可以绑定到云主机的某个虚拟网卡，也可以直接绑定到路由器上，为路由器及挂载在路由器上的子网提供公网接入。

### 7.5.2 浮动IP列表 {#7-5-2}

登录控制台，点击左侧导航栏“网络->浮动IP管理”，即可查看浮动IP列表。其中各字段含义如下：

* 浮动IP：浮动IP地址，点击IP地址后方的下拉按钮可查看浮动IP的UUID。
* 状态：展示浮动IP当前的状态。
* 已映射固定IP地址：浮动IP已关联的固定IP地址。
* 带宽：浮动IP的带宽，单位是Mbps。
* 外部网络：创建转发规则时，系统将会为端口转发字段分配路由端口。
* 描述：对浮动IP的描述。
* 创建时间：端口转发规则创建成果的时间。
* 项目：浮动IP所属项目。

在浮动IP列表中，用户可通过输入浮动IP地址进行精确查询，也可按照外部网络和项目名称进行筛选。

### 7.5.3 浮动IP相关操作 {#7-5-3}

针对浮动IP的操作包括：创建浮动IP、编辑浮动IP、删除浮动IP、关联端口以及取消关联端口。

| 操作 | 前提条件 |描述 |
| :--- || :--- || :--- |
| 创建浮动IP | -- | 点击右上角“创建浮动IP”按钮，在弹出框中输入描述信息，选择网络分区、外部网络及子网，设置浮动IP，然后点击“确定”按钮即可。</br>注意，可创建的浮动IP数量是有限制的。|
| 编辑浮动IP | 浮动IP未关联端口 | 在浮动IP列表中，点击要修改的浮动IP右侧的编辑图标，在弹出框中修改描述、带宽值，然后点击“确定”按钮即可。|
| 删除浮动IP | 浮动IP未关联端口 | 在浮动IP列表中，点击要删除的浮动IP右侧的删除图标，弹窗提示是否确定释放该浮动IP，点击“确定”完成释放。</br>被释放的IP从浮动IP列表中删除，可被重新用来分配。注意不保证虚拟机可再次分配到同一IP。 |
| 关联端口 | -- | 点击特定浮动IP右侧的更多操作图标，在下拉菜单中选择“关联端口”。在弹窗中选择要关联的端口后，同时设置带宽，最后点击“关联”完成外网IP与内网IP的映射（如主机的IP地址，或负载均衡的vIP）。|
| 取消关联端口 | -- | 要解除浮动IP和内网IP的关联，点击该浮动IP右侧的更多操作图标，在下拉菜单中选择“取消关联端口”，弹窗提示是否取消关联，点击“确定”解除关联。</br>解除关联后的浮动IP仍在列表中显示，也可以关联其他内网IP。 |

![](/assets/创建浮动IP.png)

## 7.6 虚拟IP管理 {#7-6}

### 7.6.1 功能说明 {#7-6-1}

金山私有云平台提供主机的虚拟IP地址实现灵活云主机的连接冗余。一个虚拟IP地址也可能在一台主机发生故障时可用，交由另一个可选主机响应连接。虚拟IP地址是一个不属于某特定主机相连的漂移IP地址。数据包被发送到这个虚拟IP地址，但是所有的数据还是经过真实的网络接口。

### 7.6.2 虚拟IP列表 {#7-6-2}

登录控制台，点击左侧导航栏“网络->虚拟IP管理”，进入到虚拟IP管理页面。其中各字段含义如下：

* 虚拟IP：虚拟IP地址。
* 所属网络：虚拟IP所属网络。
* 所属子网：虚拟IP所属子网。
* 关联主机网卡：展示了虚拟IP已关联的主机网卡个数，如已关联主机网卡，点击下拉按钮可查看已关联主机网卡IP及主机名称。
* 项目：浮动IP所属项目。

在虚拟IP列表中，用户可通过输入虚拟IP地址进行精确查询，也可按照项目名称进行筛选。

### 7.6.3 虚拟IP相关操作 {#7-6-3}

对虚拟IP 的操作包括：创建虚拟IP、释放虚拟IP及关联管理。

| 操作 | 前提条件 |描述 |
| :--- || :--- || :--- |
| 创建虚拟IP | -- | 点击右上角“创建虚拟IP”按钮，在弹出框中选择网络、选择子网并分配IP，最后点击“确定”按钮即可。|
| 关联管理 | -- | 选中一个虚拟IP，点击右侧“关联管理”，在弹出框中可增删要关联的主机。</br>注意：每个虚拟IP最多可关联5个主机网卡，每个网卡可被多个虚拟IP关联（没有数量限制）。|
| 释放虚拟IP | 虚拟IP关联的主机网卡数为0 | 在虚拟IP列表中，点击要删除的浮动IP右侧的“释放虚拟IP”，弹窗提示是否确定释放该虚拟IP，点击“确定”完成释放。|

![](/assets/虚拟IP-关联多主机.png)

### 7.6.4 其他注意事项 {#7-6-4}

1. 如果在云主机那里删除了某台主机，则此台主机自动取消与所有虚拟IP的关联。
2. 释放虚拟IP，自动取消与所有云主机的关联。

## 7.7 防火墙管理 {#7-7}

### 7.7.1 功能说明 {#7-7-1}

防火墙用来保证内部网络与外部网络之间的网络安全。

### 7.7.2 防火墙列表 {#7-7-2}

登录控制台，点击左侧导航栏“网络->防火墙管理”，进入到防火墙管理页面。其中，各字段含义如下：

* 名称：防火墙的名字，用户创建时填写。
* 状态：表示是否存在路由开启此防火墙，“活动”表示存在。
* 相关路由器：开启此防火墙的路由器列表。
* 描述：描述信息由用户创建时填写。
* 项目：防火墙所属项目。

在防火墙列表中，用户可通过输入防火墙名称进行精确查询，也可按照项目名称进行筛选。

### 7.7.3 防火墙相关操作 {#7-7-3}

针对防火墙的操作包括：创建防火墙、绑定路由和删除防火墙。

| 操作 |描述 |
| :--- || :--- |
| 创建防火墙 | 点击右上角“创建防火墙”按钮，在弹出的窗口中填写防火墙的名称、描述，并为该防火墙添加规则。</br>创建防火墙时至少要设置一条规则，也可以有多条规则。|
| 绑定路由 | 选中一个防火墙，点击右上角的“更多操作”按钮，在下拉框中选择“绑定路由”，页面弹出“防火墙绑定路由”窗口。</br>可选择的路由器列表为该项目组下所有的路由器，勾选表示此路由器添加该防火墙，不勾选表示此路由器不添加该防火墙。</br>一个路由器只能添加一个防火墙，不同的路由器可以设置同一个防火墙。</br>勾选完要绑定的路由器后，点击“确定”完成绑定。|
| 删除防火墙 | 选中防火墙，在更多操作下拉框中选择“删除”，弹窗提示是否确定删除该防火墙，点击“确定”完成删除。|

![](/assets/创建防火墙.png)

### 7.7.4 防火墙规则列表 {#7-7-4}

点击防火墙名称，可查看该防火墙的规则列表，列表中包含了以下信息：协议、动作、源IP、源端口、目的IP、目的端口。

### 7.7.5 规则相关操作 {#7-7-5}

可以为防火墙创建新的规则，也可删除已有的规则。

| 操作 |描述 |
| :--- || :--- |
| 创建规则 | 点击右上角“创建规则”按钮，在弹出的窗口中选择协议、动作，填写源IP地址和目的IP地址，点击“创建防火墙规则”按钮完成创建。|
| 删除规则 | 选中要删除的规则，点击右上角的删除按钮，在确认框中点击“删除”按钮完成删除。|

## 7.8 安全组管理 {#7-8}

### 7.8.1 功能说明 {#7-8-1}

安全组是云主机虚拟网卡的上行和下行流量的防火墙，表示虚拟网卡的上行安全组规则。Kingstack的所有数据流量都是通过虚拟网卡进出的，安全组包含一组白名单安全组规则，一个安全组规则允许某一特定数据包流入、流出虚拟网卡。

### 7.8.2 安全组列表 {#7-8-2}

登录控制台，点击左侧导航栏“网络->安全组管理”，进入到安全组管理页面。其中各字段含义如下：

* 名称：安全组的名字，用户可编辑修改。
* 项目：表示该安全组所属项目。
* 描述：对安全组的简单描述，用户可编辑修改。 

在安全组列表中，用户可通过输入安全组名称进行精确查询，也可按照项目名称进行筛选。

### 7.8.3 安全组相关操作 {#7-8-3}

针对安全组的操作包括创建安全组、编辑安全组、删除安全组。

| 操作 |描述 |
| :--- || :--- |
| 创建安全组 | 点击安全组列表左上角的“创建安全组”按钮，在弹窗中填写安全组名称和描述信息，点击“确定”完成创建。|
| 编辑安全组 | 选中要编辑的安全组，点击右上角的“更多操作”按钮，在下拉框中选择“编辑安全组”，在弹窗中修改名称和描述信息，点击“更新”按钮完成修改。|
| 删除安全组 | 选中要删除的安全组，点击右上角的“更多操作”按钮，在下拉框中选择“删除安全组”，在确认框中点击“删除”按钮完成删除。|

### 7.8.4 安全组规则列表 {#7-8-4}

点击安全组名称，可查看该安全组的规则列表，列表中包含了以下信息：方向、以太网类型、IP协议、端口范围、远程IP前缀、远程安全组。

### 7.8.5 安全组规则相关操作 {#7-8-5}

针对安全组的操作包括创建、删除安全组规则。

| 操作 |描述 |
| :--- || :--- |
| 创建安全规则 | 点击右上角“创建安全规则”按钮，在弹出的窗口中填写相关，点击“确定”按钮完成创建。|
| 删除安全规则 | 选中要删除的规则，点击右上角的“更多操作”按钮，在下拉框中选择“删除安全规则”，在确认框中点击“删除”按钮完成删除。|

## 7.9 负载均衡 {#7-9}

### 7.9.1 负载均衡列表 {#7-9-1}

登录控制台，选择左侧“网络”下的“负载均衡”，即可查看负载均衡器列表，其中，各字段含义如下：

名称：负载均衡的名字，由用户添加时填写。
子网：负载均衡器放置的网段。
状态：成功创建的负载均衡状态为“活动”。
VIP：负载均衡器的虚拟IP。
VIP：负载均衡器的虚拟IP。
网络分区：负载均衡器所在的网络分区。
描述：关于负载均衡的描述信息，由用户添加时填写。

### 7.9.2 负载均衡相关操作 {#7-9-2}

针对负载均衡的操作包括创建负载均衡、编辑负载均衡、删除负载均衡。

| 操作 |描述 |
| :--- || :--- |
| 创建负载均衡 | 点击安全组列表左上角的“创建安全组”按钮，在弹窗中填写安全组名称和描述信息，点击“确定”完成创建。|
| 编辑负载均衡 | 选中要编辑的安全组，点击右上角的“更多操作”按钮，在下拉框中选择“编辑安全组”，在弹窗中修改名称和描述信息，点击“更新”按钮完成修改。|
| 删除负载均衡 | 选中要删除的负载均衡，点击右上角的“更多操作”按钮，在下拉框中选择“删除”，在确认框中点击“删除”按钮完成删除。|

1.1.2	创建LB在负载均衡列表的右上角，点击“创建负载均衡”按钮，在弹窗中填写完毕后，点击“确定”完成创建。
1.1.3	更多操作在负载均衡列表中，选中LB，点击右上角“更多操作”下拉框，可以选择的操作有：编辑或删除。点击“更多操作->编辑”，可在弹出框中修改负载均衡名称和描述，点击“确定”完成修改。选择“删除”操作，弹窗提示是否确定删除该LB，点击“删除”即可。

### 7.9.3 负载均衡详情 {#7-9-3}

点击负载均衡名字，可查看该负载均衡器的详细描述，包括“基本信息”和“监听器”。

基本信息包括：名称、描述、标识、项目标识、状态、协议、方法和子网，点击右上角的操作按钮，可修改负载均衡器的名称和描述。
监听器列表信息包括：监听器名称、描述、协议类型（TCP/HTTP/HTTPS）和端口号。监听器列表右上角提供“添加监听器”按钮，点击可创建监听器。。也可以在列表右侧修改或删除监听器。创建Listener

## 7.10 VPN管理 {#9-10}



## 7.11 网络拓扑图 {#9-11}

### 7.11.1 功能说明

金山私有云平台提供网络拓扑图功能，方便用户清晰直观地获取某一项目下网络连接的具体情况。外部网关、路由、路由上关联的网络，网络内的子网，子网上链接的云主机信息都会在网络拓扑图中清晰地展现出来。

### 7.11.2 基础操作

1. 用户可以登录控制台查看项目组的网络拓扑图: 登录控制台，选择左侧“网络”下的“网络拓扑图”，即可查看该项目组的网络拓扑图。

 ![](/assets/网络拓扑图 1.png)

2. 在网络拓扑图中，点击路由和虚拟主机的名字，可查看关于它的详细描述: 

 ![](/assets/网络拓扑图 2 .png)

 



