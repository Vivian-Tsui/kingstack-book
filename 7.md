# 7. 网络服务 {#7}

如果用户的云主机有访问外网的需求，可以通过三种方式实现：

1. 云主机关联浮动IP，关联浮动IP的云主机可从外部被访问到。
2. 云主机所在子网关联路由器，因为路由器在创建时分配的IP就是浮动IP。
3. 通过端口转发功能，创建虚机端口与路由端口的端口转发规则。

权限说明

待补充

## 7.1 外部网络管理 {#7-1}

待补充

## 7.2 网络管理 {#7-2}

### 7.2.1 功能说明 {#7-2-1}

用户可创建多个网络，在每个网络内，可创建多个子网，处于同一个子网内的主机可以相互通信，子网之间是完全隔离的。如果两个子网之间需要通信，需要将两个子网关联到同一个路由器。

### 7.2.2 网络列表 {#7-2-2}

点击左侧导航栏“网络->网络管理”，进入网络管理页面，即可查看当前网络列表，列表所含字段具体如下：

* 名称：网络的名字，由用户创建网络时填写。
* 状态：该字段显示当前网络是否正常可用。
* 网络类型：vlan、flat等。
* 物理网络：网络所关联的物理网络。
* 分段标识：一个整数数字，在创建网络完成时由系统随机分配。
* 项目：网络所属的租户名称。

在网络列表中，用户可通过输入网络名称、分段标识和物理机网络的名称进行精确查询，也可按照网络分区和项目名称进行筛选。

### 7.2.3 网络相关操作 {#7-2-3}

针对网络的操作包括：创建网络、编辑网络、删除网络。

| 操作 | 前提条件 | 描述 |
| :--- | | :--- | | :--- |
| 创建网络 | 当前项目下已经创建至少一个路由 | 点击右上角“创建网络”按钮，在弹窗中输入网络名称，选择网络区域，填写子网名称、网络地址、网关IP，然后选择一个匹配的路由，最后点击“确定”按钮。 |
| 编辑网络 | -- | 选中一个网络，点击右上角“更多操作->编辑网络”，可在弹出框中更改网络名称。 |
| 删除网络 | 网络下没有子网 | 选中一个网络，若它包含的子网数为零，点击右上角“更多操作->删除网络”。 |

创建网络弹窗：

![](/assets/创建网络弹窗.png)

### 7.2.4 子网列表 {#7-2-4}

点击具体网络的名称，将打开该网络下的子网列表。其中，各字段含义如下：

* 名称：子网的名字，在创建子网时由用户填写。
* 网络地址：显示子网所在网段。
* IP版本：IPV4。
* 网关IP：网关IP为创建子网时指定。
* 关联路由：子网所关联的路由。

### 7.2.5 子网相关操作 {#7-2-5}

针对子网的操作包括：创建子网、编辑子网、删除子网。

| 操作 | 前提条件 | 描述 |
| :--- | | :--- | | :--- |
| 创建子网 | 当前项目下已经创建至少一个路由 | 点击右上角“创建网络”按钮，在弹窗中输入子网名称、网络地址、网关IP，然后选择一个匹配的路由，最后点击“确定”按钮。 |
| 编辑子网 | -- | 选中一个子网，点击右上角“更多操作->编辑子网”，可在弹出框中更改子网名称。 |
| 删除子网 | a. 该子网没有关联任何路由</br>b. 该子网的IP没有分配到任何云主机上| 选中一个子网，若它没有关联任何资源，点击右上角“更多操作->删除子网”，在弹出框中点击“删除”即可。 |

## 7.3 路由管理 {#7-3}

### 7.3.1 功能说明 {#7-3-1}

路由主要有两个作用：

1. 作为外网与用户私有网络之间的通道：比如开启外网关并绑定外网IP之后，便可以通过VPN或端口转发功能从外部访问云内部网络资源。
2. 作为用户多个子网之间路由功能。

### 7.3.2 路由列表 {#7-3-2}

登录控制台，点击左侧导航栏“网络->路由管理”，即可查看路由列表。其中，各个字段的含义如下：

* 名称：路由器的名字，由用户创建时填写。
* 状态：表示该路由当前是否正常可用。
* 带宽：表示当前路由的带宽，单位为Mbps。
* 外部网关：创建路由时选择的外部网络，默认为external。
* 外部IP：创建路由时自动分配。
* 类型：ha/活动/占用，表示不同的路由类型。
* 标识：uuid，路由唯一标识符。
* 项目：路由所属的项目。

### 7.3.3 路由相关操作 {#7-3-3}

针对路由的操作包括：创建路由、编辑路由、修改带宽、删除路由。

| 操作 | 前提条件 | 描述 |
| :--- | | :--- | | :--- |
| 创建路由 | -- | 点击右上角“创建路由”按钮，在弹出的输入框中输入路由器名称，选择网络分区和外部网络（默认为external），设置带宽，最后点击“创建”按钮即可创建路由器。 |
| 编辑路由 | -- | 点击路由右侧的编辑图标，可在弹出框中更改路由名称。 |
| 修改带宽 | -- | 点击路由右侧的“修改带宽”功能链接，可在弹出框中更改路由带宽。 |
| 删除路由 | 该路由上已经没有关联的子网、端口转发、vpn等 | 若某个路由没有关联任何资源，点击右侧的删除图标，在弹出框中点击“删除”即可。 |

在路由列表中，用户可通过输入路由名称、外部IP进行精确查询，也可按照网络分区和项目名称进行筛选。

![](/assets/创建路由.png)

### 7.3.4 路由接口列表 {#7-3-4}

点击某个路由的名称，即可进入到该路由的接口列表。其中，各个字段的含义如下：

* 固定IP：关联子网的网关IP。
* 关联子网：关联到该路由上的子网。
* 状态：指示该接口当前是否正常可用。

### 7.3.5 接口相关操作 {#7-3-5}

在接口列表可进行的操作有：添加接口、删除接口。

| 操作 | 前提条件 | 描述 |
| :--- | | :--- | | :--- |
| 添加接口 | -- | 点击右上角“添加接口”按钮，在弹窗中选择子网，点击“添加按钮”按钮即可。 |
| 删除接口 | 该接口未关联任何资源 | 选中一个接口，若它没有关联任何资源，点击右上角“更多操作->删除接口”，在弹出框中点击“删除”即可。 |

## 7.4 端口转发管理 {#7-4}

### 7.4.1 功能说明 {#7-4-1}

金山私有云向用户提供端口转发功能，实现了用一个public IP，通过不同的端口以及TCP/UDP协议映射来访问不同机器。端口转发创建成功后，能将针对路由器公网IP地址的某个端口的请求转发到子网的某个云主机IP地址上，而不需要给每个云主机均绑定公网IP来访问，避免将子网主机完全暴露在公网中，并能缓解公网IP资源匮乏的问题。

### 7.4.2 端口转发规则列表 {#7-4-2} 

登录控制台，点击左侧导航栏“网络->端口转发管理”，即可查看端口转发规则列表。其中各字段含义如下：

* 规则名称：端口转发规则的名称，由用户创建时填写。
* 虚机IP地址：与转发规则相关联虚机的IP地址。
* 虚机端口：由用户手动填写，端口范围为：0-65535。
* 路由器网关IP：与转发规则相关联的路由器网关IP。
* 路由器端口：创建转发规则时，系统将会为端口转发字段分配路由端口。
* 协议：TCP/IP
* 创建时间：端口转发规则创建成果的时间。
* 项目：端口转发规则所属项目。
* 描述：对端口转发规则的描述。

在端口转发列表中，用户可通过输入端口转发规则名称、虚机IP进行精确查询，也可按照项目名称进行筛选。

### 7.4.3 相关操作 {#7-4-3}

| 操作 | 描述 |
| :--- | | :--- |
| 创建转发规则 | 点击右上角“创建转发规则”按钮，在弹窗中输入规则名称、规则描述（可选），选择虚机所属网络、选择虚机IP地址(选择虚机IP地址后，会自动匹配出路由器网关IP)，填写虚机端口并选择协议，最后点击“确定”创建转发规则。 |
| 删除转发规则 | 点击转发规则右侧的删除图标，在弹窗中点击“删除”即可。 |

![](/assets/关联路由器网关IP.png)

### 7.4.4 注意事项 {#7-4-4}

1. 删除虚机，删除对应规则。
2. 删除路由器，删除对应规则。
3. 对于一个特定虚机的特定端口，可以配置多条规则。
4. 对于一个特定路由器的特定端口，每种协议只能配置一次。

## 7.5 浮动IP管理 {#7-5}

### 7.5.1 功能说明 {#7-5-1}

浮动IP为云主机和路由器提供全球可直接访问的互联网地址，可以绑定到云主机的某个虚拟网卡，也可以直接绑定到路由器上，为路由器及挂载在路由器上的子网提供公网接入。

### 7.5.2 浮动IP列表

登录控制台，点击左侧导航栏“网络->浮动IP管理”，即可查看浮动IP列表。其中各字段含义如下：

* 浮动IP：浮动IP地址。
* 状态：展示浮动IP当前的状态。
* 已映射固定IP地址：浮动IP已关联的固定IP地址。
* 带宽：浮动IP的带宽，单位是Mbps。
* 外部网络：创建转发规则时，系统将会为端口转发字段分配路由端口。
* 描述：对浮动IP的描述。
* 创建时间：端口转发规则创建成果的时间。
* 项目：浮动IP所属项目。

在浮动IP列表中，用户可通过输入浮动IP地址进行精确查询，也可按照外部网络和项目名称进行筛选。

### 7.5.3 浮动IP相关操作 

针对浮动IP 的操作包括：创建浮动IP、编辑浮动IP、删除浮动IP、关联端口以及取消关联端口。

| 操作 | 前提条件 |描述 |
| :--- || :--- || :--- |
| 创建浮动IP | -- | 点击右上角“创建浮动IP”按钮，在弹出框中输入描述信息，选择网络分区、外部网络及子网，设置浮动IP，然后点击“确定”按钮即可。</br>注意，可创建的浮动IP数量是有限制的。|
| 编辑浮动IP | 浮动IP未关联端口 | 在浮动IP列表中，点击要修改的浮动IP右侧的编辑图标，在弹出框中修改描述、带宽值，然后点击“确定”按钮即可。|
| 删除浮动IP | 浮动IP未关联端口 | 在浮动IP列表中，点击要删除的浮动IP右侧的删除图标，弹窗提示是否确定释放该浮动IP，点击“确定”完成释放。</br>被释放的IP从浮动IP列表中删除，可被重新用来分配。注意不保证虚拟机可再次分配到同一IP。 |
| 关联端口 | -- | 点击特定浮动IP右侧的更多操作图标，在下拉菜单中选择“关联端口”。在弹窗中选择要关联的端口后，同时设置带宽，最后点击“关联”完成外网IP与内网IP的映射（如主机的IP地址，或负载均衡的vIP）。|
| 取消关联端口 | -- | 要解除浮动IP和内网IP的关联，点击该浮动IP右侧的更多操作图标，在下拉菜单中选择“取消关联端口”，弹窗提示是否取消关联，点击“确定”解除关联。</br>解除关联后的浮动IP仍在列表中显示，也可以关联其他内网IP。 |








